@using System.Data
@using Microsoft.AspNetCore.Mvc.Rendering
@using ServiceStack
@using ServiceStack.Data
@using ServiceStack.OrmLite
@using SoundWords
@using SoundWords.Models
@model IndexResponse
@{
    ViewBag.Title = "Sunne ord";
    ushort? oldest = Db.Scalar<ushort?>(Db.From<DbRecording>().Where(r => r.Year != null).Select(r => Sql.Min(r.Year)));

    IPageTool pageTool = ResolveService<IPageTool>();

}

@Html.RenderMarkdown(pageTool.Get("Welcome"))
@if (AppSettings.Get("SHOW_LATEST_ALBUMS", true))
{
    <partial for="LatestAlbums" name="LatestAlbumsPartial"/>
}
@Html.RenderMarkdown(pageTool.Get("WelcomeFooter"))

@section Sidebar
    {
    <partial for="Speakers" name="SpeakersPartial" />
}

@section scripts
    {
    <script type="text/javascript">
        $(function () {
            $('#auth').removeClass('hidden');
            var userNameSet = false;
            try {
                userNameSet = !!window.localStorage["userName"];
            } catch (e) { }

            if (userNameSet) {
                createLoginForm();
            } else {
                createRegisterForm();
            }

            $("input").change($.ss.clearAdjacentError);

            $("a.podcast").tooltip();
        });


    </script>
}

@section metadata
    {
    @{
        var openGraphMetaData = ResolveService<OpenGraphMetaData>();
        openGraphMetaData.Title = ViewBag.Title;
        openGraphMetaData.Description = "På sunneord.no kan du lytte til bibelundervisning fra perioden mellom {0} og i dag. &quot;... lik et tre, plantet ved rennende bekker.&quot;".Fmt(oldest);
        openGraphMetaData.Url = Request.GetApplicationUrl();
    }
    <partial model="openGraphMetaData" name="MetaDataPartial" />
}